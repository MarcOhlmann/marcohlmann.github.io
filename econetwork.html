<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />



<meta name="date" content="2019-01-07" />

<title>A tutorial on the ‘econetwork’ package</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link href="site_libs/ionicons-2.0.1/css/ionicons.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Marc Ohlmann</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-info"></span>
     
    About me
  </a>
</li>
<li>
  <a href="publications.html">
    <span class="ion ion-document-text"></span>
     
    Publications
  </a>
</li>
<li>
  <a href="tutorials.html">
    <span class="fa fa-tutorial"></span>
     
    Tutorial
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="marcohlmann@live.fr">
    <span class="fa fa-envelope-o"></span>
     
    Contact me
  </a>
</li>
<li>
  <a href="https://github.com/MarcOhlmann">
    <span class="fa fa-github"></span>
     
    
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">A tutorial on the ‘econetwork’ package</h1>
<h4 class="date">2019-01-07</h4>

</div>


<div
id="computing-network-diversity-and-dissimilarity-using-hill-numbers-at-different-species-aggregation-levels"
class="section level2">
<h2>Computing network diversity and dissimilarity using Hill numbers at
different species aggregation levels</h2>
<p>Here is a tutorial on the ‘econetwork’ where the network diversity
indices described in Ohlmann et al. 2019 Ecol. Let. are implemented. We
will simulate a dataset of networks and then compute diversities indices
and dissimilarities at different nodes aggregation levels (i.e
species).</p>
<div id="installing-the-pacakge" class="section level3">
<h3>Installing the pacakge</h3>
<p>The package is availabel on CRAN. Just run :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(&#39;econetwork&#39;)</span></span></code></pre></div>
</div>
<div id="building-a-simulated-datase-of-networks-using-the-block-model"
class="section level3">
<h3>Building a simulated datase of networks using the Block Model</h3>
<p>Here, we build a simulated dataset that consists in a list of labeled
graphs (by the names of the species). To do so, we will sample local
networks in random model of graph : the Block Model.
<strong>Careful</strong> : the <em>sample_sbm</em> function of the
‘igraph’ package does not sample a Stochastic Block Model but a Block
Model since the groups are fixed <em>a priori</em>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#required packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(econetwork)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(intergraph)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sna)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sample the metaweb</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">400</span> <span class="co">#number of species</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">cbind</span>( <span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">01</span>,.<span class="dv">001</span>,.<span class="dv">001</span>), <span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">001</span>,.<span class="dv">01</span>,.<span class="dv">001</span>), <span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">001</span>,.<span class="dv">001</span>,.<span class="dv">01</span>), <span class="fu">c</span>(.<span class="dv">001</span>, .<span class="dv">001</span>,.<span class="dv">001</span>,.<span class="dv">001</span>) ) <span class="co">#probability of links between blocks (i.e. groups of species)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>gMeta <span class="ot">&lt;-</span> <span class="fu">sample_sbm</span>(N, <span class="at">pref.matrix=</span>pm, <span class="at">block.sizes=</span><span class="fu">c</span>(N<span class="sc">/</span><span class="dv">4</span>,N<span class="sc">/</span><span class="dv">4</span>,N<span class="sc">/</span><span class="dv">4</span>,N<span class="sc">/</span><span class="dv">4</span>),<span class="at">directed =</span> T)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(gMeta)<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span>N)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># to get a nice layout !</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>goldenRatio <span class="ot">&lt;-</span> (<span class="fu">sqrt</span>(<span class="dv">5</span>) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>fibonacciAngle <span class="ot">&lt;-</span> <span class="dv">360</span><span class="sc">/</span>(goldenRatio<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>numPoints <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,numPoints)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,numPoints)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numPoints) {</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> c<span class="sc">*</span><span class="fu">sqrt</span>(n)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> fibonacciAngle<span class="sc">*</span>(n)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  x[n] <span class="ot">&lt;-</span> r<span class="sc">*</span><span class="fu">cos</span>(theta)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  y[n] <span class="ot">&lt;-</span> r<span class="sc">*</span><span class="fu">sin</span>(theta)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="fl">0.2</span><span class="sc">*</span>x,y),<span class="fu">cbind</span>(<span class="fl">0.4</span><span class="sc">*</span>x,y<span class="dv">-50</span>),<span class="fu">cbind</span>(<span class="fl">0.6</span><span class="sc">*</span>x,y<span class="dv">-100</span>),<span class="fu">cbind</span>(x,y<span class="dv">-150</span>))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>gMeta_ggnet <span class="ot">&lt;-</span> intergraph<span class="sc">::</span><span class="fu">asNetwork</span>(<span class="fu">as.undirected</span>(gMeta))</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>gMeta_ggnet <span class="sc">%v%</span> <span class="st">&quot;x&quot;</span> <span class="ot">=</span> coords[, <span class="dv">1</span>]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>gMeta_ggnet <span class="sc">%v%</span> <span class="st">&quot;y&quot;</span> <span class="ot">=</span> coords[, <span class="dv">2</span>]</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggnet2</span>(gMeta_ggnet, <span class="at">mode =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),<span class="at">node.size =</span> <span class="dv">2</span>,<span class="at">color =</span> <span class="st">&#39;skyblue&#39;</span>,<span class="at">edge.color =</span> <span class="st">&#39;grey&#39;</span>,<span class="at">alpha =</span> <span class="fl">0.7</span>)  <span class="sc">+</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;black&quot;</span>))<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="st">&quot;lines&quot;</span>)) </span></code></pre></div>
<p><img src="econetwork_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#build the local networks</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#We sample local networks from the metanework</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining local communities (i.e. nodes of the network) and local networks as induced subgraph of the metanetwork. We remove some edges of the local network to simulate plasticity of interactions.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>speciesList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>gList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  speciesLoc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span>(N<span class="sc">/</span><span class="dv">4-2</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">2</span>)),<span class="fu">as.character</span>((N<span class="sc">/</span><span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>N<span class="sc">/</span><span class="dv">4-4</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">4</span>)),<span class="fu">as.character</span>((<span class="dv">2</span><span class="sc">*</span>N<span class="sc">/</span><span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>N<span class="sc">/</span><span class="dv">4-8</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">8</span>)),<span class="fu">as.character</span>((<span class="dv">3</span><span class="sc">*</span>N<span class="sc">/</span><span class="dv">4</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(N<span class="dv">-16</span><span class="sc">*</span>k<span class="sc">+</span><span class="dv">16</span>)))</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  gLoc <span class="ot">&lt;-</span> <span class="fu">induced_subgraph</span>(gMeta, speciesLoc)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(k <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    gLoc<span class="ot">&lt;-</span><span class="fu">delete_edges</span>(gLoc, <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">E</span>(gLoc)))[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span>k]) <span class="co">#randomly remove edges</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span><span class="fu">paste0</span>(<span class="st">&#39;g_&#39;</span>,k,<span class="st">&#39;_ggnet &lt;- intergraph::asNetwork(as.undirected(gLoc))&#39;</span>)))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span><span class="fu">paste0</span>(<span class="st">&#39;g_&#39;</span>,k,<span class="st">&#39;_ggnet %v% &quot;x&quot; = coords[as.numeric(speciesLoc), 1]&#39;</span>)))</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span><span class="fu">paste0</span>(<span class="st">&#39;g_&#39;</span>,k,<span class="st">&#39;_ggnet %v% &quot;y&quot; = coords[as.numeric(speciesLoc), 2]&#39;</span>)))</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>(<span class="fu">parse</span>(<span class="at">text=</span><span class="fu">paste0</span>(<span class="st">&#39;p_&#39;</span>,k,<span class="st">&#39;&lt;-ggnet2(g_&#39;</span>,k,<span class="st">&#39;_ggnet, mode = c(&quot;x&quot;, &quot;y&quot;),node.size = 2,color = &quot;skyblue&quot;,edge.color = &quot;grey&quot;,alpha = 0.7)  + </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="st">                         theme(panel.background = element_rect(fill = &quot;black&quot;))+theme(legend.position = &quot;none&quot;)+  </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="st">                         theme(plot.margin = unit(c(0,0,0,0), &quot;lines&quot;))&#39;</span>)))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  speciesList <span class="ot">&lt;-</span> <span class="fu">c</span>(speciesList,<span class="fu">list</span>(speciesLoc))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  gList <span class="ot">&lt;-</span> <span class="fu">c</span>(gList,<span class="fu">list</span>(gLoc))</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_1, p_2, p_3,p_4, <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="at">heights=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span></code></pre></div>
<p><img src="econetwork_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(gList) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span>K)</span></code></pre></div>
</div>
</div>
<div id="cluster-similar-species-in-groups" class="section level1">
<h1>Cluster similar species in groups</h1>
<p>The method allows to compute diversity indices/dissimilarities at
different aggregation levels. In the case of these simulated data, the
groups are knwon. However, on ecological data, the groups can be
inferred using the stochastic block model (not to generate networks but
to infer groups) using the ‘blockmodels’ R package (for example).</p>
</div>
<div id="computing-diversities-and-dissimilarities"
class="section level1">
<h1>Computing diversities and dissimilarities</h1>
<p>alpha-, beta- and gamma-diversities</p>
<p>We first compute diversity indices at different aggregation levels.
Importantly, it is possible to compute alpha-, gamma- and
beta-diversities of species (or group) abundances), link abundances or
link probabilities while varying a parameter eta that gives more weight
to abundant group/links/link probabilities. Moreover, for diversity
indices computation, two framework are implemented ‘RLC’ (for Reeve
Leinster Cobbold) and ‘Chao’ (for Prof. Chao). The presentation and
pros/cons of the different frameworks can be found in the Supplementary
Information of Ohlmann et al. 2019 Ecol. Let. For eta=0, abundances do
not matter. For eta=1, the indices are linked to Shannon entropy (alpha-
and gamma-diversity) and to Kullback-Leibler divergence
(beta-diversity).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining the group vector </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>,N<span class="sc">/</span><span class="dv">4</span>),<span class="fu">rep</span>(<span class="dv">2</span>,N<span class="sc">/</span><span class="dv">4</span>),<span class="fu">rep</span>(<span class="dv">3</span>,N<span class="sc">/</span><span class="dv">4</span>),<span class="fu">rep</span>(<span class="dv">4</span>,N<span class="sc">/</span><span class="dv">4</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(groups) <span class="ot">&lt;-</span> <span class="fu">V</span>(gMeta)<span class="sc">$</span>name</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Diversity indices at a species level (microscopic diversity) with eta=1 and Reeve Leinster Cobbold framework</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;P&#39;</span>)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 353.4074
## 
## $Alphas
##   1   2   3   4 
## 400 370 340 310 
## 
## $Beta
## [1] 1.077629
## 
## $Gamma
## [1] 380.8421</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>div_L <span class="ot">&lt;-</span> <span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;L&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>mAlpha</span></code></pre></div>
<pre><code>## [1] 327.1062</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Alphas</span></code></pre></div>
<pre><code>##   1   2   3   4 
## 417 350 306 259</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Beta</span></code></pre></div>
<pre><code>## [1] 1.15933</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Gamma <span class="co">#we do not look at div_L$meta</span></span></code></pre></div>
<pre><code>## [1] 379.2242</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;Pi&#39;</span>)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 262.5318
## 
## $Alphas
##   1   2   3   4 
## 269 263 259 259 
## 
## $Beta
## [1] 1.021477
## 
## $Gamma
## [1] 268.1702</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Diversity indices at a group level (mesoscopic diversity) </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> groups,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;P&#39;</span>)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 3.967339
## 
## $Alphas
##        1        2        3        4 
## 4.000000 3.993193 3.967244 3.909559 
## 
## $Beta
## [1] 1.003291
## 
## $Gamma
## [1] 3.980397</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>div_groups_L <span class="ot">&lt;-</span> <span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> groups,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;L&#39;</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>div_groups_L<span class="sc">$</span>mAlpha</span></code></pre></div>
<pre><code>## [1] 8.332559</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>div_groups_L<span class="sc">$</span>Alphas</span></code></pre></div>
<pre><code>##        1        2        3        4 
## 8.680880 8.391806 8.304003 7.982241</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>div_groups_L<span class="sc">$</span>Beta</span></code></pre></div>
<pre><code>## [1] 1.007779</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>div_groups_L<span class="sc">$</span>Gamma</span></code></pre></div>
<pre><code>## [1] 8.397379</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> groups,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;Pi&#39;</span>)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 8.725425
## 
## $Alphas
##        1        2        3        4 
## 8.680880 8.611878 8.765948 8.841934 
## 
## $Beta
## [1] 1.003265
## 
## $Gamma
## [1] 8.753912</code></pre>
<p>For interpretation of these indices, we refer to Ohlmann et
al. 2019.</p>
<p>In order to describe ecological network patterns, dissimilarity
indices on group abundances, link abundances and link probabilities
based on diversity indices can be computed. Here again, the eta
parameter change the weight given to abundant groups/links/link
probabilities.</p>
</div>
<div id="adding-species-abundances" class="section level1">
<h1>Adding species abundances</h1>
<p>It is also possible to use species abundances in the computation of
diversity indices. To do so, use the ‘abTable’ argument.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>abTable <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>K,<span class="cf">function</span>(x) <span class="fu">rpois</span>(N,<span class="dv">1</span>)<span class="sc">+</span><span class="dv">1</span>) <span class="co">#generating random non nul abundance data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(abTable) <span class="ot">=</span> <span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span>N) </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>sp_loc <span class="ot">&lt;-</span> <span class="fu">lapply</span>(gList,<span class="cf">function</span>(g) <span class="fu">V</span>(g)<span class="sc">$</span>name) <span class="co">#setting to 0 the abundances of species that are absent locally</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>K){</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  abTable[<span class="fu">setdiff</span>(<span class="fu">as.character</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">400</span>), sp_loc[[i]]),i] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;P&#39;</span>,<span class="at">abTable =</span> abTable)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 316.3209
## 
## $Alphas
##        1        2        3        4 
## 359.0785 328.0253 307.2179 276.6739 
## 
## $Beta
## [1] 1.170381
## 
## $Gamma
## [1] 370.216</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>div_L <span class="ot">&lt;-</span> <span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;L&#39;</span>,<span class="at">abTable =</span> abTable)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>mAlpha</span></code></pre></div>
<pre><code>## [1] 263.8852</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Alphas</span></code></pre></div>
<pre><code>##        1        2        3        4 
## 337.4243 271.2651 253.8983 210.6823</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Beta</span></code></pre></div>
<pre><code>## [1] 1.357389</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>div_L<span class="sc">$</span>Gamma <span class="co">#we do not look at div_L$meta</span></span></code></pre></div>
<pre><code>## [1] 358.1947</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">divPartition</span>(<span class="at">gList =</span> gList,<span class="at">groups =</span> <span class="cn">NULL</span>,<span class="at">eta =</span> <span class="dv">1</span>,<span class="at">framework =</span> <span class="st">&#39;RLC&#39;</span>, <span class="at">type =</span> <span class="st">&#39;Pi&#39;</span>,<span class="at">abTable =</span> abTable)</span></code></pre></div>
<pre><code>## $mAlpha
## [1] 262.5318
## 
## $Alphas
##   1   2   3   4 
## 269 263 259 259 
## 
## $Beta
## [1] 1.021477
## 
## $Gamma
## [1] 268.1702</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
